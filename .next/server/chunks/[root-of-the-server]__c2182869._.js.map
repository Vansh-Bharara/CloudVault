{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 66, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/mongodbClient.ts"],"sourcesContent":["import { MongoClient } from \"mongodb\";\n\nconst uri = process.env.MONGODB_URI!;\nconst options = {};\n\nlet client;\nlet clientPromise: Promise<MongoClient>;\n\nif (!process.env.MONGODB_URI) {\n  throw new Error(\"Please add your Mongo URI to .env.local\");\n}\n\nif (process.env.NODE_ENV === \"development\") {\n  // @ts-ignore\n  if (!global._mongoClientPromise) {\n    client = new MongoClient(uri, options);\n    // @ts-ignore\n    global._mongoClientPromise = client.connect();\n  }\n  // @ts-ignore\n  clientPromise = global._mongoClientPromise;\n} else {\n  client = new MongoClient(uri, options);\n  clientPromise = client.connect();\n}\n\nexport default clientPromise;\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,MAAM,UAAU,CAAC;AAEjB,IAAI;AACJ,IAAI;AAEJ,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAE;IAC5B,MAAM,IAAI,MAAM;AAClB;AAEA,wCAA4C;IAC1C,aAAa;IACb,IAAI,CAAC,4CAAO,mBAAmB,EAAE;QAC/B,SAAS,IAAI,uGAAA,CAAA,cAAW,CAAC,KAAK;QAC9B,aAAa;QACb,4CAAO,mBAAmB,GAAG,OAAO,OAAO;IAC7C;IACA,aAAa;IACb,gBAAgB,4CAAO,mBAAmB;AAC5C;;uCAKe","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/auth.ts"],"sourcesContent":["// app/lib/auth.ts\nimport { NextAuthOptions } from \"next-auth\";\nimport GoogleProvider from \"next-auth/providers/google\";\nimport { MongoDBAdapter } from \"@auth/mongodb-adapter\";\nimport clientPromise from \"@/lib/mongodbClient\";\n\nexport const authOptions: NextAuthOptions = {\n  adapter: MongoDBAdapter(clientPromise),\n  providers: [\n    GoogleProvider({\n      clientId: process.env.GOOGLE_CLIENT_ID!,\n      clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\n    }),\n  ],\n  secret: process.env.NEXTAUTH_SECRET,\n  callbacks: {\n    async session({ session, user }) {\n      // attach db id to session.user.id\n      if (session?.user) session.user.id = user.id ?? (user as any)._id;\n      return session;\n    },\n  },\n};\n"],"names":[],"mappings":"AAAA,kBAAkB;;;;AAElB;AACA;AACA;;;;AAEO,MAAM,cAA+B;IAC1C,SAAS,CAAA,GAAA,uJAAA,CAAA,iBAAc,AAAD,EAAE,sHAAA,CAAA,UAAa;IACrC,WAAW;QACT,CAAA,GAAA,qJAAA,CAAA,UAAc,AAAD,EAAE;YACb,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;QAChD;KACD;IACD,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,WAAW;QACT,MAAM,SAAQ,EAAE,OAAO,EAAE,IAAI,EAAE;YAC7B,kCAAkC;YAClC,IAAI,SAAS,MAAM,QAAQ,IAAI,CAAC,EAAE,GAAG,KAAK,EAAE,IAAI,AAAC,KAAa,GAAG;YACjE,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 133, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/mongodb.ts"],"sourcesContent":["import mongoose from \"mongoose\";\n\nconst MONGODB_URI = process.env.MONGODB_URI!;\n\nif (!MONGODB_URI) {\n  throw new Error(\"Please define the MONGODB_URI in .env.local\");\n}\n\nlet cached = (global as any).mongoose;\n\nif (!cached) {\n  cached = (global as any).mongoose = { conn: null, promise: null };\n}\n\nexport async function connectDB() {\n  if (cached.conn) return cached.conn;\n\n  if (!cached.promise) {\n    cached.promise = mongoose.connect(MONGODB_URI, {\n      dbName: process.env.MONGODB_DB,\n    }).then((mongoose) => mongoose);\n  }\n  cached.conn = await cached.promise;\n  return cached.conn;\n}\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MAAM;AAClB;AAEA,IAAI,SAAS,4CAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,4CAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEO,eAAe;IACpB,IAAI,OAAO,IAAI,EAAE,OAAO,OAAO,IAAI;IAEnC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,OAAO,GAAG,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,aAAa;YAC7C,QAAQ,QAAQ,GAAG,CAAC,UAAU;QAChC,GAAG,IAAI,CAAC,CAAC,WAAa;IACxB;IACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IAClC,OAAO,OAAO,IAAI;AACpB","debugId":null}},
    {"offset": {"line": 251, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/models/File.ts"],"sourcesContent":["// lib/models/File.ts\nimport mongoose, { Schema } from \"mongoose\";\n\nexport interface IFile {\n  ownerId: Schema.Types.ObjectId;\n  originalName: string;\n  latestVersion: number;\n}\n\nconst FileSchema = new Schema<IFile>({\n  ownerId:{\n    type:Schema.Types.ObjectId,\n    required:true,\n    index:true,\n  },\n  originalName:{\n    type:String,\n    required:true,\n  },\n  latestVersion:{\n    type:Number,\n    default:0,\n  },\n}, {timestamps:true});\n\n// Prevent model overwrite on hot reload\nexport default (mongoose.models.File as mongoose.Model<IFile>) ||\n  mongoose.model(\"File\", FileSchema);\n"],"names":[],"mappings":"AAAA,qBAAqB;;;;AACrB;;AAQA,MAAM,aAAa,IAAI,yGAAA,CAAA,SAAM,CAAQ;IACnC,SAAQ;QACN,MAAK,yGAAA,CAAA,SAAM,CAAC,KAAK,CAAC,QAAQ;QAC1B,UAAS;QACT,OAAM;IACR;IACA,cAAa;QACX,MAAK;QACL,UAAS;IACX;IACA,eAAc;QACZ,MAAK;QACL,SAAQ;IACV;AACF,GAAG;IAAC,YAAW;AAAI;uCAGJ,AAAC,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,IAAI,IAClC,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,QAAQ","debugId":null}},
    {"offset": {"line": 279, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/models/FileVersion.ts"],"sourcesContent":["import mongoose, {Schema, models} from \"mongoose\";\n\nconst FileVersionSchema = new Schema({\n    fileId:{\n        type:Schema.Types.ObjectId,\n        ref:\"File\",\n        required:true,\n        index:true\n    },\n    versionNumber:{\n        type:Number,\n        required:true,\n    },\n    s3Key:{\n        type:String,\n        required:true,\n    },\n    size:{\n        type:Number,\n        required:true,\n    },\n    mimeType:{\n        type:String,\n        required:true,\n    },\n    uploadedAt:{\n        type:Date,\n        default:Date.now\n    },\n})\n\nexport default models.FileVersion ||\n  mongoose.model(\"FileVersion\", FileVersionSchema);"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,oBAAoB,IAAI,yGAAA,CAAA,SAAM,CAAC;IACjC,QAAO;QACH,MAAK,yGAAA,CAAA,SAAM,CAAC,KAAK,CAAC,QAAQ;QAC1B,KAAI;QACJ,UAAS;QACT,OAAM;IACV;IACA,eAAc;QACV,MAAK;QACL,UAAS;IACb;IACA,OAAM;QACF,MAAK;QACL,UAAS;IACb;IACA,MAAK;QACD,MAAK;QACL,UAAS;IACb;IACA,UAAS;QACL,MAAK;QACL,UAAS;IACb;IACA,YAAW;QACP,MAAK;QACL,SAAQ,KAAK,GAAG;IACpB;AACJ;uCAEe,yGAAA,CAAA,SAAM,CAAC,WAAW,IAC/B,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,eAAe","debugId":null}},
    {"offset": {"line": 373, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/lib/s3.ts"],"sourcesContent":["import { S3Client, PutObjectCommand, GetObjectCommand, DeleteObjectCommand } from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\n\nconst region = process.env.AWS_REGION!\nconst bucket = process.env.S3_BUCKET_NAME!\n\nif(!region || !bucket){\n    throw new Error(\"Please set up AWS_REGION and S3_BUCKET_NAME in .nv.local\")\n}\n\nconst s3 = new S3Client({\n    region,\n    credentials:{\n        accessKeyId:process.env.AWS_ACCESS_KEY_ID!,\n        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!\n    }\n})\n\nexport async function getPresignedUploadUrl(key:string, contentType:string,expiresIn = 900){\n    const command = new PutObjectCommand({\n        Bucket:bucket,\n        Key:key,\n        ContentType:contentType\n    })\n    const url = await getSignedUrl(s3, command, {expiresIn})\n    return url\n}\n\nexport async function getPresignedDownloadUrl(key:string, expiresIn = 900){\n    const command = new GetObjectCommand({\n        Bucket:bucket,\n        Key:key\n    })\n    const url = await await getSignedUrl(s3,command,{expiresIn})\n    return url\n}\n\nexport async function deleteS3Object(key:string){\n    const command = new DeleteObjectCommand({\n        Bucket:bucket,\n        Key:key\n    })\n    return s3.send(command)\n}\n\n\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,QAAQ,GAAG,CAAC,UAAU;AACrC,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;AAEzC,IAAG,CAAC,UAAU,CAAC,QAAO;IAClB,MAAM,IAAI,MAAM;AACpB;AAEA,MAAM,KAAK,IAAI,iJAAA,CAAA,WAAQ,CAAC;IACpB;IACA,aAAY;QACR,aAAY,QAAQ,GAAG,CAAC,iBAAiB;QACzC,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB;IACtD;AACJ;AAEO,eAAe,sBAAsB,GAAU,EAAE,WAAkB,EAAC,YAAY,GAAG;IACtF,MAAM,UAAU,IAAI,iJAAA,CAAA,mBAAgB,CAAC;QACjC,QAAO;QACP,KAAI;QACJ,aAAY;IAChB;IACA,MAAM,MAAM,MAAM,CAAA,GAAA,0LAAA,CAAA,eAAY,AAAD,EAAE,IAAI,SAAS;QAAC;IAAS;IACtD,OAAO;AACX;AAEO,eAAe,wBAAwB,GAAU,EAAE,YAAY,GAAG;IACrE,MAAM,UAAU,IAAI,iJAAA,CAAA,mBAAgB,CAAC;QACjC,QAAO;QACP,KAAI;IACR;IACA,MAAM,MAAM,MAAM,MAAM,CAAA,GAAA,0LAAA,CAAA,eAAY,AAAD,EAAE,IAAG,SAAQ;QAAC;IAAS;IAC1D,OAAO;AACX;AAEO,eAAe,eAAe,GAAU;IAC3C,MAAM,UAAU,IAAI,iJAAA,CAAA,sBAAmB,CAAC;QACpC,QAAO;QACP,KAAI;IACR;IACA,OAAO,GAAG,IAAI,CAAC;AACnB","debugId":null}},
    {"offset": {"line": 427, "column": 0}, "map": {"version":3,"sources":["file:///Users/vansshbarara/Desktop/e/web%20dev/ntccMajorCloudVault/app/api/files/upload/init/route.ts"],"sourcesContent":["import { authOptions } from \"@/lib/auth\";\nimport { connectDB } from \"@/lib/mongodb\";\nimport { error } from \"console\";\nimport { getServerSession } from \"next-auth\";\nimport { NextResponse } from \"next/server\";\nimport File from \"@/lib/models/File\";\nimport FileVersion from \"@/lib/models/FileVersion\";\nimport { getPresignedUploadUrl } from \"@/lib/s3\";\n\n\n\nexport async function POST(req:Request){\n    await connectDB();\n\n    //authenticate the user through session\n    const session = await getServerSession(authOptions)\n    if(!session?.user?.id){\n        return NextResponse.json(\n            {error:\"Unauthorized\"},\n            {status:401}\n        )\n    }\n\n    const userId = session.user.id\n\n    //read request body\n    const {originalFileName, size, mimeType} = await req.json()\n\n    if(!originalFileName || !size || !mimeType){\n        return NextResponse.json(\n            {error:\"Missing required fields\"},\n            {status: 400}\n        )\n    }\n\n    //check if the file already exists\n    const existingFile = await File.findOne({\n        ownerId: userId,\n        originalName: originalFileName\n    })\n\n    // versioning\n    let versionNumber:number;\n    let fileId: string\n\n    if(!existingFile){\n        versionNumber = 1;\n        const newFile = await File.create({\n            ownerId:userId,\n            originalName:originalFileName,\n            latestVersion:versionNumber,\n        });\n        fileId = newFile._id.toString()\n    }\n    else{\n        versionNumber = existingFile.latestVersion + 1;\n        fileId = existingFile._id.toString()\n        await File.updateOne(\n            {_id:fileId},\n            {$set:{latestVersion:versionNumber}}\n        )\n    }\n\n    const safeName = originalFileName.replace(/\\s+/g, \"_\");\n    const s3Key = `uploads/${userId}/${fileId}/v${versionNumber}_${safeName}`;\n\n    await FileVersion.create({\n        fileId,\n        versionNumber,\n        s3Key:\"PENDING\",\n        size,\n        mimeType\n    })\n\n    const uploadUrl = await getPresignedUploadUrl(s3Key,mimeType)\n\n    return NextResponse.json({\n        fileId,\n        versionNumber,\n        s3Key,\n        uploadUrl\n    })\n\n}"],"names":[],"mappings":";;;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AAIO,eAAe,KAAK,GAAW;IAClC,MAAM,CAAA,GAAA,gHAAA,CAAA,YAAS,AAAD;IAEd,uCAAuC;IACvC,MAAM,UAAU,MAAM,CAAA,GAAA,uIAAA,CAAA,mBAAgB,AAAD,EAAE,6GAAA,CAAA,cAAW;IAClD,IAAG,CAAC,SAAS,MAAM,IAAG;QAClB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;YAAC,OAAM;QAAc,GACrB;YAAC,QAAO;QAAG;IAEnB;IAEA,MAAM,SAAS,QAAQ,IAAI,CAAC,EAAE;IAE9B,mBAAmB;IACnB,MAAM,EAAC,gBAAgB,EAAE,IAAI,EAAE,QAAQ,EAAC,GAAG,MAAM,IAAI,IAAI;IAEzD,IAAG,CAAC,oBAAoB,CAAC,QAAQ,CAAC,UAAS;QACvC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACpB;YAAC,OAAM;QAAyB,GAChC;YAAC,QAAQ;QAAG;IAEpB;IAEA,kCAAkC;IAClC,MAAM,eAAe,MAAM,uHAAA,CAAA,UAAI,CAAC,OAAO,CAAC;QACpC,SAAS;QACT,cAAc;IAClB;IAEA,aAAa;IACb,IAAI;IACJ,IAAI;IAEJ,IAAG,CAAC,cAAa;QACb,gBAAgB;QAChB,MAAM,UAAU,MAAM,uHAAA,CAAA,UAAI,CAAC,MAAM,CAAC;YAC9B,SAAQ;YACR,cAAa;YACb,eAAc;QAClB;QACA,SAAS,QAAQ,GAAG,CAAC,QAAQ;IACjC,OACI;QACA,gBAAgB,aAAa,aAAa,GAAG;QAC7C,SAAS,aAAa,GAAG,CAAC,QAAQ;QAClC,MAAM,uHAAA,CAAA,UAAI,CAAC,SAAS,CAChB;YAAC,KAAI;QAAM,GACX;YAAC,MAAK;gBAAC,eAAc;YAAa;QAAC;IAE3C;IAEA,MAAM,WAAW,iBAAiB,OAAO,CAAC,QAAQ;IAClD,MAAM,QAAQ,CAAC,QAAQ,EAAE,OAAO,CAAC,EAAE,OAAO,EAAE,EAAE,cAAc,CAAC,EAAE,UAAU;IAEzE,MAAM,8HAAA,CAAA,UAAW,CAAC,MAAM,CAAC;QACrB;QACA;QACA,OAAM;QACN;QACA;IACJ;IAEA,MAAM,YAAY,MAAM,CAAA,GAAA,2GAAA,CAAA,wBAAqB,AAAD,EAAE,OAAM;IAEpD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QACrB;QACA;QACA;QACA;IACJ;AAEJ","debugId":null}}]
}